@using Bnan.Core.Extensions;
@using Bnan.Ui.ViewModels.BS;
﻿@using Microsoft.AspNetCore.Builder;
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Localization;
@using Microsoft.AspNetCore.Http.Features;
@using Microsoft.AspNetCore.Mvc.Localization;
@using Microsoft.EntityFrameworkCore;
@using Microsoft.Extensions.Options;
@model BSLayoutVM
@inject UserManager<CrMasUserInformation> userManager
@inject SignInManager<CrMasUserInformation> signinManager
@inject IViewLocalizer localizer
@*@model Bnan.Ui.ViewModels.CAS.LayoutVM*@
@inject IOptions<RequestLocalizationOptions> options
@{
    var user = await userManager.GetUserAsync(User);
    var lessorInfo = await userManager.Users.Include(l => l.CrMasUserInformationLessorNavigation).ThenInclude(l => l.CrMasLessorImage).FirstOrDefaultAsync(x => x.UserName == user.UserName);
    var lessorCompanyContract = await userManager.Users.Include(l => l.CrMasUserInformationLessorNavigation).ThenInclude(l => l.CrMasContractCompanies).FirstOrDefaultAsync(x => x.UserName == user.UserName);
    var userInfo = await userManager.Users
          .Include(l => l.CrMasUserMainValidations)
          .Include(l => l.CrMasUserSubValidations)
          .Include(l => l.CrMasUserInformationLessorNavigation)
          .FirstOrDefaultAsync(l => l.UserName == user.UserName);
    string url = Context.Request.Path;
    string urlhost = Context.Request.Host.Value;
    string full = urlhost + url;
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var returnUrl = ViewData["returnUrl"];
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="شركة كدي لتأجير السيارات ">
    <meta name="author" content="">
    <title>@ViewData["Title"]</title>
    @*     <title>الفروع - الرئيسية</title>
    *@
    <link rel="shortcut icon" href="~/Bnan.png" type="image/x-icon" />
    <!-- Custom styles for this template-->
    <link href="~/BranchSys/css/sb-admin-2.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    @*  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> *@
    <link href="https://fonts.googleapis.com/css2?family=Cairo+Play:wght@200;300;400;500&family=Cairo:wght@200&display=swap"
          rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Cairo:500,400,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/toastr.css" />
    <link rel="stylesheet" href="~/css/icons.min.css" />
    <link href="~/BranchSys/css/style.css" rel="stylesheet">
    @if (requestCulture?.RequestCulture.UICulture.Name == "en-US")
    {
        <link href="~/BranchSys/css/En-style.css" rel="stylesheet">
    }

    <style>
        .noti-icon-badge {
            display: inline-block;
            position: absolute;
            top: 22px;
            right: 6px;
            border-radius: 50%;
            height: 7px;
            width: 7px;
            background-color: #fa5c7c;
        }

        .alert {
            color: #fff;
            background-color: #FF992E;
            flex-direction: row-reverse;
            font-size: .7rem;
            font-weight: 600;
            margin-bottom: 0;
            border: 1px solid #4e73df;
            padding: 0.5rem 0.6rem;
        }

        .dropdown-item-custom {
            display: flex;
            flex-direction: row-reverse;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e3e6f0;
            font-size: .7rem;
            flex-direction: row-reverse;
        }

        .ended-Docs-Num {
            color: red;
        }

        .Not-ended-Docs-Num {
            color: #FF992E;
        }
    </style>

</head>

<body id="page-top" style="background-color:rgba(254, 248, 232, 1);font-family:'Cairo', 'sans-serif'">



    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light topbar mb-2 static-top shadow  justify-content-between" style="height:100px;">
                <!-- Topbar Navbar -->
                <ul class="navbar-nav ">


                    <!-- Nav Item - User Information -->
                    <li class="nav-item dropdown no-arrow">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <img class="img-profile rounded-circle" src="@Url.Content(user.CrMasUserInformationPicture?.ToString())" style="margin-right: 12px;height:53px;width:53px">
                            <div style="display: flex; flex-direction: column;">
                                @if (signinManager.IsSignedIn(User))
                                {
                                    @if (requestCulture.RequestCulture.UICulture.Name != "en-US")
                                    {
                                        <span class=" text-dark font-weight-bold" style="font-size: 16px;">
                                            @((await userManager.GetUserAsync(User)).CrMasUserInformationArName)
                                        </span>
                                        <span class="text-dark" style="font-size: 13px;font-weight: 400;">
                                            @((await userManager.GetUserAsync(User)).CrMasUserInformationTasksArName)
                                        </span>
                                    }
                                    else
                                    {
                                        <span class=" text-dark font-weight-bold" style="font-size: 16px;">
                                            @((await userManager.GetUserAsync(User)).CrMasUserInformationEnName)
                                        </span>
                                        <span class="text-dark" style="font-size: 13px;font-weight: 400;">
                                            @((await userManager.GetUserAsync(User)).CrMasUserInformationTasksEnName)
                                        </span>
                                    }

                                }
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-left shadow animated--grow-in text-right" style="font-size: 16px;font-weight: 600;color: black;" aria-labelledby="userDropdown">
                            <!-- item-->
                            <div class="dropdown-header noti-title dropdown-item">
                                <h6 class="text-overflow m-0">@localizer["Welcome"]</h6>
                            </div>

                            <!-- item-->
                            <a class="dropdown-item notify-item" data-toggle="modal" data-target="#AccountModal">
                                <i class="mdi mdi-account-circle me-1"></i>
                                <span>@localizer["My Account"]</span>
                            </a>
                            <a class="dropdown-item notify-item" data-toggle="modal" data-target="#PasswordModal">
                                <i class="mdi mdi-onepassword me-1"></i>
                                <span>@localizer["ChangePassword"]</span>
                            </a>
                            @if ((user.CrMasUserInformationAuthorizationAdmin == true && user.CrMasUserInformationAuthorizationBranch == true) ||
                            (user.CrMasUserInformationAuthorizationAdmin == true && user.CrMasUserInformationAuthorizationOwner == true) ||
                            (user.CrMasUserInformationAuthorizationBranch == true && user.CrMasUserInformationAuthorizationOwner == true))
                            {
                                <a asp-area="Identity" asp-controller="Account" asp-action="System" class="dropdown-item notify-item">
                                    <i class="mdi mdi-access-point-network me-1"></i>
                                    <span>@localizer["Systems"]</span>
                                </a>
                            }

                            <!-- item-->
                            <a asp-area="Identity" asp-controller="Account" asp-action="Logout" class="dropdown-item notify-item">
                                <i class="mdi mdi-logout me-1"></i>
                                <span>@localizer["logout"]</span>
                            </a>
                        </div>
                    </li>
                    <!-- Nav Item - Messages -->
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="dripicons-message noti-icon" style="font-size: 22px;vertical-align: middle;line-height: 70px;color: #7a7272;"></i>
                            <!-- Counter - Messages -->
                            <span class="noti-icon-badge"></span>
                        </a>
                        <!-- Dropdown - Messages -->
                        <div class="dropdown-list dropdown-menu dropdown-menu-left shadow animated--grow-in"
                             aria-labelledby="messagesDropdown">
                            <h6 class="dropdown-header" style="background-color: #FF992E">
                                مركز الرسائل
                            </h6>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="dropdown-list-image mr-3">
                                    <img class="rounded-circle" src="~/BranchSys/img/undraw_profile_1.svg" alt="...">
                                    <div class="status-indicator bg-success"></div>
                                </div>
                                <div class="font-weight-bold">
                                    <div class="text-truncate">
                                        Hi there! I am wondering if you can help me with a
                                        problem I've been having.
                                    </div>
                                    <div class="small text-dark-600">Emily Fowler · 58m</div>
                                </div>
                            </a>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="dropdown-list-image mr-3">
                                    <img class="rounded-circle" src="~/BranchSys/img/undraw_profile_2.svg" alt="...">
                                    <div class="status-indicator"></div>
                                </div>
                                <div>
                                    <div class="text-truncate">
                                        I have the photos that you ordered last month, how
                                        would you like them sent to you?
                                    </div>
                                    <div class="small text-dark-600">Jae Chun · 1d</div>
                                </div>
                            </a>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="dropdown-list-image mr-3">
                                    <img class="rounded-circle" src="~/BranchSys/img/undraw_profile_3.svg" alt="...">
                                    <div class="status-indicator bg-warning"></div>
                                </div>
                                <div>
                                    <div class="text-truncate">
                                        Last month's report looks great, I am very happy with
                                        the progress so far, keep up the good work!
                                    </div>
                                    <div class="small text-dark-600">Morgan Alvarez · 2d</div>
                                </div>
                            </a>
                            <a class="dropdown-item d-flex align-items-center" href="#">
                                <div class="dropdown-list-image mr-3">
                                    <img class="rounded-circle" src="https://source.unsplash.com/Mv9hjnEUHR4/60x60"
                                         alt="...">
                                    <div class="status-indicator bg-success"></div>
                                </div>
                                <div>
                                    <div class="text-truncate">
                                        Am I a good boy? The reason I ask is because someone
                                        told me that people say this to all dogs, even if they aren't good...
                                    </div>
                                    <div class="small text-dark-600">Chicken the Dog · 2w</div>
                                </div>
                            </a>
                            <a class="dropdown-item text-center small text-dark-600" href="#">Read More Messages</a>
                        </div>
                    </li>
                    <!-- Nav Item - Alerts -->
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button"
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="dripicons-bell noti-icon" style="font-size: 22px;vertical-align: middle;line-height: 70px;color: #7a7272;"></i>
                            <!-- Counter - Alerts -->
                            <span class="noti-icon-badge"></span>
                        </a>
                        <!-- Dropdown - Alerts -->
                        <div class="dropdown-list dropdown-menu dropdown-menu-left shadow animated--grow-in" aria-labelledby="alertsDropdown">
                            <div class="row alert">
                                <div class="col-6" style="text-align:end;">
                                    @localizer["Notifications"]
                                </div>

                                <div class="col-4">
                                    @localizer["OnExpiredd"]
                                </div>
                                <div class="col-2">
                                    @localizer["Expired"]
                                </div>
                            </div>
                            <a class="dropdown-item dropdown-item-custom ">
                                <div class="col-md-7 p-0" style="text-align:end;">
                                    @localizer["ContractBranch"]
                                </div>
                                <div class="col-md-3 Not-ended-Docs-Num">
                                    @ViewBag.CompanyDocumentsExpiredBS
                                </div>
                                <div class="col-md-2 ended-Docs-Num">
                                    @ViewBag.CompanyDocumentsAboutExpireBS
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item-custom ">
                                <div class="col-md-7 p-0" style="text-align:end;">
                                    @localizer["CarsDocuments"]
                                </div>
                                <div class="col-md-3 Not-ended-Docs-Num">
                                    @ViewBag.CompanyDocumentsCarExpiredBS
                                </div>
                                <div class="col-md-2 ended-Docs-Num">
                                    @ViewBag.CompanyDocumentsCarAboutExpireBS
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item-custom ">
                                <div class="col-md-7 p-0" style="text-align:end;">
                                    @localizer["CarsFixed"]
                                </div>
                                <div class="col-md-3 Not-ended-Docs-Num">
                                    @ViewBag.CompanyMaintainceCarExpiredBS
                                </div>
                                <div class="col-md-2 ended-Docs-Num">
                                    @ViewBag.CompanyMaintainceCarAboutExpireBS
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item-custom ">
                                <div class="col-md-7 p-0" style="text-align:end;">
                                    @localizer["CarPrice"]
                                </div>

                                <div class="col-md-3 Not-ended-Docs-Num">
                                    @ViewBag.PriceCarExpiredBS
                                </div>
                                <div class="col-md-2 ended-Docs-Num">
                                    @ViewBag.PriceCarAboutExpireBS
                                </div>
                            </a>
                        </div>
                    </li>
                    <!-- Nav Item - Language -->
                    <li class="nav-item dropdown no-arrow mx-2 me-2">
                        @if (requestCulture.RequestCulture.UICulture.Name == "en-US")
                        {
                            <a class="nav-link dropdown-toggle" role="button" asp-area="BS" asp-controller="Home" asp-action="SetLanguage" asp-route-returnUrl="@returnUrl" asp-route-culture="ar-EG">
                                <span class="align-middle" style="color: #8d8282;font-size: 14px;font-weight: 600;">Ar</span>
                            </a>
                        }
                        else
                        {
                            <a class="nav-link dropdown-toggle" role="button" asp-area="BS" asp-controller="Home" asp-action="SetLanguage" asp-route-returnUrl="@returnUrl" asp-route-culture="en-US">
                                <span class="align-middle" style="color: #8d8282;font-size: 14px;font-weight: 600;">En</span>
                            </a>
                        }
                    </li>
                </ul>
                @if (lessorInfo.CrMasUserInformationLessorNavigation.CrMasLessorInformationStatus == Status.Hold)
                {
                    <div class=" d-flex align-items-center on-mobile" style="color:red; font-weight: bold;font-size:14px;margin-top: 3%;">
                        @localizer["CompanyIsHoldInSystems"]
                    </div>
                }
                else if (user.CrMasUserInformationStatus == Status.Hold)
                {
                    <div class=" d-flex align-items-center on-mobile" style="color:red; font-weight:bold;font-size:14px;margin-top: 3%;">
                        @localizer["EmployeeHoldedInBS"]
                    </div>
                }
                else if (lessorCompanyContract?.CrMasUserInformationLessorNavigation?.CrMasContractCompanies.LastOrDefault(x => x.CrMasContractCompanyLessor == lessorInfo.CrMasUserInformationLessor && x.CrMasContractCompanyProcedures == "112")?.CrMasContractCompanyStatus == Status.Renewed)
                {
                    <div style="color:red;font-weight:300" id="dangerMessage">@localizer["ContractNewDanger"]</div>

                }
                else if (lessorCompanyContract?.CrMasUserInformationLessorNavigation?.CrMasContractCompanies.LastOrDefault(x => x.CrMasContractCompanyLessor == lessorInfo.CrMasUserInformationLessor && x.CrMasContractCompanyProcedures == "112")?.CrMasContractCompanyStatus == Status.Expire)
                {
                    <div style="color:red;font-weight:300" id="dangerMessage">@localizer["ContractExpireDanger"]</div>

                }
                else if (lessorCompanyContract?.CrMasUserInformationLessorNavigation?.CrMasContractCompanies.LastOrDefault(x => x.CrMasContractCompanyLessor == lessorInfo.CrMasUserInformationLessor && x.CrMasContractCompanyProcedures == "112")?.CrMasContractCompanyStatus == Status.AboutToExpire)
                {
                    <div style="color:red;font-weight:300" id="dangerMessage">@localizer["ContractAboutExpireDanger"]</div>
                }

                <!-- logo -->
                <div class=" d-flex align-items-center on-mobile" style="color:black;">
                    <div class="pt-sm-0 pt-md-4  pt-lg-4 pt-xl-4">
                        <h1 class="hide-on-mobile" style="font-size: 1.2rem;font-weight: bold;">
                            @if (signinManager.IsSignedIn(User))
                            {
                                @if (requestCulture.RequestCulture.UICulture.Name != "en-US")
                                {
                                    @Html.Raw(lessorInfo.CrMasUserInformationLessorNavigation?.CrMasLessorInformationArLongName)
                                }
                                else
                                {
                                    @Html.Raw(lessorInfo.CrMasUserInformationLessorNavigation?.CrMasLessorInformationEnLongName)
                                }
                            }
                        </h1>
                        <p class="extra-small-mobile">
                            @if (requestCulture.RequestCulture.UICulture.Name != "en-US")
                            {
                                @Model.CrCasBranchInformations?.Find(x=>x.CrCasBranchInformationCode==Model.SelectedBranch)?.CrCasBranchInformationArShortName
                            }
                            else
                            {
                                @Model.CrCasBranchInformations?.Find(x=>x.CrCasBranchInformationCode==Model.SelectedBranch)?.CrCasBranchInformationEnShortName
                            }
                            @if (Model.CrCasBranchInformations?.Find(x => x.CrCasBranchInformationCode == Model.SelectedBranch)?.CrCasBranchInformationStatus == Status.Hold)
                            {
                                <span style="color: red;font-size: small;">@localizer["Holded"]</span>
                            }
                        </p>
                    </div>
                    <img class="extra-small-mobile " src="@Url.Content(lessorInfo?.CrMasUserInformationLessorNavigation?.CrMasLessorImage?.CrMasLessorImageLogo)" style="height: 60px;width: 140px;">
                </div>
            </nav>
            <!------------------------------------------end of Topbar-------------------------------------------------->
            <div class="container-fluid">
                <!-- Expiration Modal -->
                <partial name="_ExpirationModalBS" />
                <!-- Content Row -->
                <div class="row" style="justify-content: center; height:100%">
                    @RenderBody()
                </div>
                <!-- buttons  -->
            </div>

        </div>

    </div>

    <!--Modals-->
    <!-- Account Modal-->
    <div class="modal fade" id="AccountModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <form asp-area="BS" asp-action="Edit" asp-controller="Employees" enctype="multipart/form-data" method="post">
                    <div class="modal-header account-modal-header">
                        <p class="card-title">حسابي</p>

                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><img src="~/BranchSys/img/cancel.png"></span>
                        </button>

                    </div>
                    <div class="modal-body">
                        <div class="account-container">
                            <div class="row flex-row-reverse ">
                                <div class="col-md-6">
                                    <div class="row account-modal-rows">
                                        <div class="col-lg-4 account-titles">
                                            <p> رقم الموظف</p>
                                        </div>
                                        <div class="col-auto personal-data">
                                            <p> @Model.UserInformation.CrMasUserInformationCode </p>
                                        </div>
                                    </div>
                                    <div class="row account-modal-rows">
                                        <div class="col-lg-4 account-titles">
                                            <p> اسم الموظف </p>
                                        </div>
                                        <div class="col-auto personal-data">
                                            @if (requestCulture.RequestCulture.UICulture.Name != "en-US")
                                            {
                                                <p> @Model.UserInformation.CrMasUserInformationArName </p>
                                            }
                                            else
                                            {
                                                <p> @Model.UserInformation.CrMasUserInformationEnName </p>
                                            }
                                        </div>
                                    </div>
                                    <div class="row account-modal-rows">
                                        <div class="col-lg-4 account-titles">
                                            <p> الوظيفة </p>
                                        </div>
                                        <div class="col-auto personal-data">
                                            @if (requestCulture.RequestCulture.UICulture.Name != "en-US")
                                            {
                                                <p> @Model.UserInformation.CrMasUserInformationTasksArName </p>
                                            }
                                            else
                                            {
                                                <p> @Model.UserInformation.CrMasUserInformationTasksEnName </p>
                                            }
                                        </div>
                                    </div>
                                    <div class="row account-modal-rows">
                                        <div class="col-lg-4 account-titles">
                                            <p> الحد الإتماني للعهدة </p>
                                        </div>
                                        <div class="col-auto personal-data">
                                            <p>@Model.UserInformation.CrMasUserInformationCreditLimit</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 profile-image-col flex-wrap">
                                    <div class="profile-Image-div" id="Profile_Image">
                                        <img alt="Profile Image" src="@Url.Content(Model.UserInformation.CrMasUserInformationPicture?.ToString())" class="profileImage" id="User_Profile_img" name="User_Profile_img">
                                        <input type="text" id="Profile_Photo_Old" name="Profile_Photo_Old" hidden>
                                        <div class="upload_Icon_div">
                                            <a data-toggle="modal" data-target="#Profile_Pic_Modal">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none">
                                                    <path d="M3 9.8541C3 8.83011 3.83011 8 4.8541 8C5.55638 8 6.19839 7.60322 6.51246 6.97508L7.33333 5.33333C7.44329 5.11342 7.49827 5.00346 7.56062 4.90782C7.8859 4.40882 8.41668 4.08078 9.00848 4.01299C9.1219 4 9.24484 4 9.49071 4H14.5093C14.7552 4 14.8781 4 14.9915 4.01299C15.5833 4.08078 16.1141 4.40882 16.4394 4.90782C16.5017 5.00346 16.5567 5.11342 16.6667 5.33333L17.4875 6.97508C17.8016 7.60322 18.4436 8 19.1459 8C20.1699 8 21 8.83011 21 9.8541V14.8571C21 16.8619 21 17.8643 20.5402 18.5961C20.3004 18.9777 19.9777 19.3004 19.5961 19.5402C18.8643 20 17.8619 20 15.8571 20H8.14286C6.1381 20 5.13571 20 4.4039 19.5402C4.02229 19.3004 3.69961 18.9777 3.45983 18.5961C3 17.8643 3 16.8619 3 14.8571V9.8541Z"
                                                          fill="#FF9626" stroke="#FF9626" stroke-width="2" />
                                                    <circle cx="12" cy="13" r="4" fill="white" fill-opacity="0.32" />
                                                </svg>
                                            </a>
                                        </div>

                                    </div>
                                    <div class="signture_pen">
                                        <div class="signture_img" id="signture_img"></div>
                                        <a data-toggle="modal" data-target="#signature_Modal">
                                            <div class="svg-container">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                     viewBox="0 0 24 24" fill="none">
                                                    <path class="svg-path" fill-rule="evenodd" clip-rule="evenodd"
                                                          d="M19.06 3.58988L20.41 4.93988C21.2 5.71988 21.2 6.98988 20.41 7.76988L7.18 20.9999H3V16.8199L13.4 6.40988L16.23 3.58988C17.01 2.80988 18.28 2.80988 19.06 3.58988ZM5 18.9999L6.41 19.0599L16.23 9.22988L14.82 7.81988L5 17.6399V18.9999Z"
                                                          fill="#FF9626" fill-opacity="0.32" />
                                                </svg>
                                            </div>

                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="row flex-row-reverse">
                                <div class="col-md-12">
                                    <div class="row account-modal-rows">
                                        <div class="col-lg-2 account-titles">
                                            <label for="lang">اللغة الافتراضية</label>
                                        </div>
                                        <div class="col-lg-2  personal-data">
                                            <select class="form-select account-select" asp-for="@Model.UserInformation.CrMasUserInformationDefaultLanguage" id="language">
                                                <option value="AR">
                                                    العربية
                                                </option>
                                                <option value="EN">
                                                    الإنجليزية
                                                </option>
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row account-modal-rows pt-lg-3">
                                        <div class="col-lg-2 account-titles">
                                            <label for="phone">رقم الجوال </label>
                                        </div>
                                        <div class="col-lg-3 personal-data">
                                            <select id="country-code" name="country Code">
                                                <option value="+966">+966</option>
                                                <option value="+962">+962</option>
                                                <option value="+20">+20</option>
                                            </select>
                                            <input type="text" id="phone" asp-for="@Model.UserInformation.CrMasUserInformationMobileNo" class="account-select" autocomplete="off">
                                            <div class="row requird-field">
                                                <p class="d-none"> هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row account-modal-rows pt-lg-2">

                                        <div class="col-lg-2 account-titles">
                                            <label for="Email">البريد الاكتروني </label>
                                        </div>
                                        <div class="col-lg-4 personal-data">
                                            <input type="email" id="Email" asp-for="@Model.UserInformation.CrMasUserInformationEmail" class="account-select" autocomplete="off">
                                            <div class="row requird-field">
                                                <p class="d-none"> هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row account-modal-rows pt-lg-2">

                                        <div class="col-lg-2 account-titles">
                                            <label for="pass_hint"> تلميح كلمة السر </label>
                                        </div>
                                        <div class="col-lg-3 personal-data">
                                            <input type="text" id="pass_hint" asp-for="@Model.UserInformation.CrMasUserInformationRemindMe" class="account-select" autocomplete="off">
                                            <div class="row requird-field">
                                                <p class="d-none"> هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row account-modal-rows pt-lg-2">

                                        <div class="col-lg-2 account-titles">
                                            <label for="auto_logOut"> الخروج الآلي </label>
                                        </div>
                                        <div class="col-lg-1 personal-data">
                                            <input type="number" id="auto_logOut" asp-for="@Model.UserInformation.CrMasUserInformationExitTimer" class="account-select" autocomplete="off">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!--Profile Picture-->
                    <div class="modal fade" id="Profile_Pic_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-sm ">
                            <div class="modal-content">
                                <div class="modal-header account-modal-header">
                                    <p class="card-title">صورة الملف الشخصي </p>
                                    @*  <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true"><img src="~/BranchSys/img/cancel.png"></span>
                                    </button> *@
                                </div>
                                <div class="modal-body">
                                    <div class="row upload-modal">
                                        <div class="col-md-9 col-md-offset-4 col-sm-6 col-xs-12 profile-badge">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 23 23"
                                                 fill="none" class="remove_profile">
                                                <g clip-path="url(#clip0_1919_5368)">
                                                    <path d="M16.8961 22.0999H7.00445C5.42325 22.0999 4.13623 20.8129 4.13623 19.2317V4.66999C4.13623 4.04487 4.61427 3.56683 5.23939 3.56683H18.698C19.3231 3.56683 19.8011 4.04487 19.8011 4.66999V19.195C19.8011 20.8129 18.5141 22.0999 16.8961 22.0999ZM6.34255 5.77316V19.195C6.34255 19.5627 6.63673 19.8568 7.00445 19.8568H16.8961C17.2639 19.8568 17.558 19.5627 17.558 19.195V5.77316H6.34255Z"
                                                          fill="#39629C" />
                                                    <path d="M16.4916 5.77321C15.94 5.77321 15.4619 5.36872 15.3884 4.78037L15.2045 2.86822C15.1678 2.46373 14.8368 2.20632 14.4691 2.20632H9.50487C9.10038 2.20632 8.8062 2.5005 8.76943 2.86822L8.5488 4.78037C8.47525 5.36872 7.96044 5.80998 7.33532 5.77321C6.74697 5.69967 6.3057 5.18486 6.34247 4.55973L6.52633 2.64759C6.67342 1.13993 7.96044 0 9.4681 0H14.4323C15.94 0 17.227 1.13993 17.3741 2.64759L17.5579 4.55973C17.6315 5.14809 17.1902 5.69967 16.5651 5.77321C16.5651 5.77321 16.5283 5.77321 16.4916 5.77321Z"
                                                          fill="#39629C" />
                                                    <path d="M21.8603 5.77316H2.04017C1.41505 5.77316 0.937012 5.29512 0.937012 4.66999C0.937012 4.04487 1.41505 3.56683 2.04017 3.56683H21.8603C22.4854 3.56683 22.9635 4.04487 22.9635 4.66999C22.9635 5.29512 22.4854 5.77316 21.8603 5.77316Z"
                                                          fill="#39629C" />
                                                    <path d="M14.1749 17.7241C13.5498 17.7241 13.0718 17.2461 13.0718 16.6209V10.2962C13.0718 9.67103 13.5498 9.19299 14.1749 9.19299C14.8001 9.19299 15.2781 9.67103 15.2781 10.2962V16.6209C15.2781 17.2461 14.8001 17.7241 14.1749 17.7241Z"
                                                          fill="#39629C" />
                                                    <path d="M9.76234 17.7241C9.13722 17.7241 8.65918 17.2461 8.65918 16.6209V10.2962C8.65918 9.67103 9.13722 9.19299 9.76234 9.19299C10.3875 9.19299 10.8655 9.67103 10.8655 10.2962V16.6209C10.8655 17.2461 10.3875 17.7241 9.76234 17.7241Z"
                                                          fill="#39629C" />
                                                </g>
                                                <defs>
                                                    <clipPath id="clip0_1919_5368">
                                                        <rect width="22.0265" height="22.1" fill="white"
                                                              transform="translate(0.937012)" />
                                                    </clipPath>
                                                </defs>
                                            </svg>
                                            <div class="profile-pic">
                                                <img alt="User Pic" src="~/BranchSys/img/Img_load_box_fill.svg" id="upload_icon"
                                                     class="preview">

                                                <input id="profile-image-upload" type="file" onchange="previewFile()"
                                                       name="Profile_Photo" class="hidden" style="display: none;">
                                            </div>
                                            <div class="text-center pt-2">
                                                <p>تحديث الصورة</p>

                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end of Upload Profile Picture Modal-->
                    <div class="modal-footer save-button-row">
                        <button type="submit" class="btn btn-custom">حفظ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- End Account Modal -->
    <!-- passowrd Modal-->
    <div class="modal fade" id="PasswordModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered  ">
            <div class="modal-content">
                <form class="needs-validation" novalidate>
                    <div class="modal-header account-modal-header">
                        <p class="card-title">تغيير كلمة السر</p>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><img src="~/BranchSys/img/cancel.png"></span>
                        </button>
                    </div>
                    <div class="modal-body p-0">
                        <div class="account-container Password-container">
                            <div class="row " style="gap:5px">
                                <div class="col-md-12 ">
                                    <div class="row flex-row-reverse">
                                        <div class="col-md-5 pass-titles">
                                            <label for="current_pass">كلمة السر الحالية</label>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="password" id="current_pass" class="account-select"
                                                   name=" current passowrd" autocomplete="off">
                                            <div class="row requird-field">
                                                <p style="display:none;"> هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row flex-row-reverse">
                                        <div class="col-md-5 pass-titles">
                                            <label for="New_pass">كلمة السر الجديدة </label>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="password" id="New_pass" class=" account-select"
                                                   name="new passowrd" autocomplete="off">
                                            <div class="row requird-field">
                                                <p style="display:none;">هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row flex-row-reverse">
                                        <div class="col-md-5 pass-titles">
                                            <label for="New_pass_reenter">تأكيد كلمة السر الجديدة </label>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="password" id="New_pass_reenter" class=" account-select"
                                                   name="new passowrd reenter" autocomplete="off">
                                            <div class="row requird-field">
                                                <p style="display:none;">هذا الحقل مطلوب</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer save-button-row" id="passowrd-save">
                        <a id="submit" class="btn btn-custom">حفظ</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- end of change passowrd Modal-->
    <!-- Upload Profile Picture Modal -->
    <!-- Upload signature Modal -->
    <div class="modal fade" id="signature_Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered ">
            <div class="modal-content signature-modal-content">
                <form id="signature-form">
                    <div class="modal-header account-modal-header signature-modal-header">
                        <div class="anchors w-100">  <a href="#" id="Img_signture">تحميل</a>  <a href="#" class="activee" id="written_signture">كتابة</a></div>

                        <div>
                            <p class="card-title"> التوقيع </p>
                        </div>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true"><img src="~/BranchSys/img/cancel.png"></span>
                        </button>

                    </div>
                    <div class="modal-body">
                        <div class="row upload-modal">
                            <div class="col-md-9 col-lg-11 col-md-offset-4 col-sm-6 profile-badge" style="height: 200px;">
                                <div class="h-100 w-100 d-flex align-items-center justify-content-center" id="signature_content ">
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer save-button-row" id="passowrd-save">
                        <button type="submit" class="btn btn-custom" id="save">حفظ</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- end of Upload signature Modal-->
    <!-- charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.1/chart.min.js"></script>
    <!--link to make javascript function operate-->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
    <script src="~/BranchSys/js/javascript/carousel_data.js"></script>
    <script src="~/BranchSys/js/javascript/Upload_Img.js"></script>
    <script src="~/BranchSys/js/javascript/charts.js"></script>
    <script src="~/js/toastr.js"></script>
    @await RenderSectionAsync("Scripts", required: false)



    <script>
        @*Expireation pop up modal*@
            $(document).ready(function () {
                // Set an initial timeout of 60 seconds (in milliseconds)
                var exitUser = "@user.CrMasUserInformationExitTimer";
                let timeout = parseInt(exitUser) * 60 * 1000;
                let timer;

                // Function to start the countdown
                function startCountdown() {
                    timer = setInterval(updateCountdown, 1000);
                }
                function clearCountdown() {
                    clearInterval(timer);
                }

                // Function to update the countdown display
                function updateCountdown() {
                    let countdownElem = $('#countdown');
                    let timeLeft = parseInt(countdownElem.text());

                    if (timeLeft > 1) {
                        countdownElem.text(timeLeft - 1);
                    } else {
                        clearInterval(timer);
                        logout();
                    }
                }

                // Function to logout the user
                function logout() {
                    $.ajax({
                        type: "GET",
                        url: "@Url.Action("Logout", "Account", new { Area = "Identity" })",
                        success: function (response) {
                            window.location.href = "@Url.Action("Index", "Account", new { Area = "Identity" })";
                        },
                    })
                }

                // Add event listener to detect no activity
                let idleTimeout = null;

                $(document).on('click keydown mousemove', function () {
                    clearTimeout(idleTimeout);
                    idleTimeout = setTimeout(function () {
                        if ($('#popup').is(':visible')) {
                            return; // Popup already displayed, so ignore this event
                        }

                        $('#popup').modal("show");
                        startCountdown();
                    }, timeout);
                });

                // Add event listener to continue button
                $('#continueBtn').click(function () {
                    $('#countdown').text("60");
                    clearCountdown();
                    clearTimeout(idleTimeout);
                    $('#popup').modal("hide");
                });

                // Add event listener to logout button
                $('#logoutBtn').click(function () {
                    clearTimeout(idleTimeout);
                    logout();
                });
            });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var inputFields = document.querySelectorAll('input');

            inputFields.forEach(function (input) {
                input.setAttribute('autocomplete', 'off');
            });
        });
    </script>
    <script>
        // $(document).ready(function () {
        //     // Attach a change event handler to the select element
        //     $('#submit').click(function () {
        //         // Get the selected value
        //         var salesPoint = $(this).val();
        //         var branch = $("#branch").val();
        //         //Store SalesPoint Code in Hidden Input
        //         $.ajax({
        //             type: "GET",
        //             data: {
        //                 Current: branch,
        //                 New: salesPoint,
        //                 Confirm:
        //             },
        //             url: "@Url.Action("Employees", "Custody", new { Area = "BS" })",
        //             success: function (response) {
        //                 $("#CustodyData").html(response);
        //             },
        //         });
        //     });
        // });
    </script>

    
    <script>
        $(document).ready(function () {
            const signature_content = document.getElementById("signature_content ")
            const Img_signture = document.getElementById("Img_signture")
            const written_signture = document.getElementById("written_signture")
            const signture_img = document.getElementById("signture_img");

            var imageRemoved = false;



            function previewFile() {
                var preview = document.querySelector('#upload_icon');
                var file = document.querySelector('input[type=file]').files[0];
                var reader = new FileReader();
                var Profile = document.querySelector('#User_Profile_img');
                var OldProfile = document.getElementById('Profile_Photo_Old');


                reader.addEventListener("load", function () {
                    preview.src = reader.result;
                    Profile.src = reader.result;
                    preview.style.borderRadius = '50%';
                    preview.style.width = '100%';
                    preview.style.height = '100%';
                    imageRemoved = false;
                }, false);

                if (file) {
                    reader.readAsDataURL(file);
                    OldProfile.value = "True";
                }
            }

            document.addEventListener('DOMContentLoaded', function () {
                var uploadIcon = document.getElementById('upload_icon');
                var profileImageUpload = document.getElementById('profile-image-upload');

                uploadIcon.addEventListener('click', function () {
                    profileImageUpload.click();
                });
            });

            document.addEventListener('DOMContentLoaded', function () {
                var removeProfileIcon = document.querySelector('.remove_profile');
                removeProfileIcon.addEventListener('click', function () {
                    var preview = document.querySelector('#upload_icon');
                    var Profile = document.querySelector('#User_Profile_img');

                    preview.src = 'img/Img_load_box_fill.svg';
                    Profile.src = "img/User 07a.svg";
                    preview.style.borderRadius = '0%';
                    preview.style.width = 'fit-content';
                    preview.style.height = 'fit-content';
                    imageRemoved = true;
                });
            });

            document.addEventListener('DOMContentLoaded', function () {
                var removeProfileIcon = document.querySelector('.remove_profile');
                removeProfileIcon.addEventListener('click', function () {
                    if (imageRemoved) {
                        document.querySelector('#profile-image-upload').value = null;
                        document.getElementById('Profile_Photo_Old').value = "False";
                    }
                });
            });

            // ////////////////////////////////////////////////////////////////////////////////////////////
            function canvasBehavoiur() {
                signature_content.innerHTML += `
                                    <canvas id="canvas" class="canvas_signture"  height="100"></canvas>
                                  `;
                var canvas = document.getElementById('canvas');
                var ctx = canvas.getContext('2d');

                // Variables for drawing
                var drawing = false;
                var prevX = 0;
                var prevY = 0;
                var currX = 0;
                var currY = 0;

                // Draw a line between the previous point and the current point
                function drawLine(x0, y0, x1, y1) {
                    ctx.beginPath();
                    ctx.moveTo(x0, y0);
                    ctx.lineTo(x1, y1);
                    ctx.stroke();
                    ctx.closePath();
                }

                // Add event listeners to handle mouse events
                canvas.addEventListener('mousedown', function (e) {
                    drawing = true;
                    prevX = e.clientX - canvas.getBoundingClientRect().left;
                    prevY = e.clientY - canvas.getBoundingClientRect().top;
                });

                canvas.addEventListener('mousemove', function (e) {
                    if (!drawing) return;
                    currX = e.clientX - canvas.getBoundingClientRect().left;
                    currY = e.clientY - canvas.getBoundingClientRect().top;
                    drawLine(prevX, prevY, currX, currY);
                    prevX = currX;
                    prevY = currY;
                    previewCanvas();
                });

                canvas.addEventListener('mouseup', function () {
                    drawing = false;
                });

            }

            // Preview the canvas image
            function previewCanvas() {
                var canvas = document.getElementById('canvas');
                var dataURL = canvas.toDataURL();

                var previewContainer = document.getElementById('signture_img');
                var image = document.createElement('img');
                image.src = dataURL;
                image.style.width = '100px';

                previewContainer.innerHTML = '';
                previewContainer.appendChild(image);
            }

            // Upload the canvas image and submit it
            function uploadCanvas() {
                var canvas = document.getElementById('canvas');
                var dataURL = canvas.toDataURL();

                // Create a form data object
                var formData = new FormData();
                formData.append('signatureImage', dataURL);

                // Submit the form data to the server
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/upload', true);   // replace  /upload with the real server link

                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        // Handle the server response
                        console.log(xhr.responseText);
                    }
                };
                xhr.send(formData);
            }

            document.getElementById('save').addEventListener('click', function () {
                uploadCanvas();
            });

            // /////////////////////////////////////////////////////////////////////////////////////
            Img_signture.addEventListener("click", function () {
                console.log(222222222);
                written_signture.classList.remove("activee");
                Img_signture.classList.add("activee");
                signature_content.innerHTML = ``;
                signature_content.innerHTML += `
                                    <div class="upload-btn-wrapper">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="59" height="59" viewBox="0 0 59 59" fill="none">
                                        <path d="M29.3337 44.3912C27.6715 44.3912 26.4004 43.1201 26.4004 41.4579V17.1112C26.4004 15.449 27.6715 14.1779 29.3337 14.1779C30.9959 14.1779 32.2671 15.449 32.2671 17.1112V41.4579C32.2671 43.1201 30.9959 44.3912 29.3337 44.3912Z" fill="#39629C"/>
                                        <path d="M41.5554 32.2667C40.7732 32.2667 40.0887 31.9734 39.5021 31.3867L29.3332 21.3156L19.2621 31.3867C18.0887 32.5601 16.2309 32.5601 15.1554 31.3867C13.9821 30.2134 13.9821 28.3556 15.1554 27.2801L27.3776 15.0579C28.5509 13.8845 30.4087 13.8845 31.4843 15.0579L43.7065 27.2801C44.8798 28.4534 44.8798 30.3112 43.7065 31.3867C43.0221 31.9734 42.2398 32.2667 41.5554 32.2667Z" fill="#39629C"/>
                                        <path d="M29.3333 58.6667C13.2 58.6667 0 45.4667 0 29.3333C0 13.2 13.2 0 29.3333 0C45.4667 0 58.6667 13.2 58.6667 29.3333C58.6667 45.4667 45.4667 58.6667 29.3333 58.6667ZM29.3333 5.86667C16.4267 5.86667 5.86667 16.4267 5.86667 29.3333C5.86667 42.24 16.4267 52.8 29.3333 52.8C42.24 52.8 52.8 42.24 52.8 29.3333C52.8 16.4267 42.24 5.86667 29.3333 5.86667Z" fill="#39629C"/>
                                      </svg>
                                      <input type="file" name="Signature_file" id="Signature_file" />
                                    </div>
                                  `;
                const fileInput = document.getElementById("Signature_file");

                fileInput.addEventListener("change", function () {
                    const file = fileInput.files[0];
                    const reader = new FileReader();

                    reader.onload = function () {
                        const image = document.createElement("img");
                        image.src = reader.result;
                        image.style.width = '95px';

                        signture_img.innerHTML = ``;
                        signture_img.appendChild(image);
                    };

                    if (file) {
                        reader.readAsDataURL(file);
                    }
                });
            });


            written_signture.addEventListener("click", function () {
                written_signture.classList.add("activee");
                Img_signture.classList.remove("activee");
                signature_content.innerHTML = ``
                canvasBehavoiur()
            })
            canvasBehavoiur()
        });
    </script>
</body>
