@using Bnan.Ui.ViewModels.BS;
@using Microsoft.AspNetCore.Identity
@model BSLayoutVM
@inject IViewLocalizer localizer
@using Microsoft.EntityFrameworkCore;
@inject UserManager<CrMasUserInformation> userManager
@inject SignInManager<CrMasUserInformation> signinManager
@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    ViewData["returnUrl"] = string.IsNullOrEmpty(Context.Request.Path) ? "~/" : $"~{Context.Request.Path.Value}";
    var user = await userManager.GetUserAsync(User);
    var userInfo = await userManager.Users
      .Include(l => l.CrMasUserMainValidations)
      .Include(l => l.CrMasUserSubValidations)
      .Include(x => x.CrMasUserBranchValidities)
      .Include(x => x.CrMasUserContractValidity)
      .Include(l => l.CrMasUserInformationLessorNavigation)
      .FirstOrDefaultAsync(l => l.UserName == user.UserName);
}
<link href="~/BranchSys/Pages/css/style.css" rel="styleSheet">
@if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
{
    <link href="~/BranchSys/Pages/css/English_style.css" rel="styleSheet">
}
<!-- MultiStep Form -->
<div class="container-fluid" id="grad1">
    <section class="section-mainCard">
        <div class="row justify-content-center w-100 h-100">
            <div class="col-11 col-sm-10 col-md-11 col-lg-11 col-xl-10 text-center p-0 ">
                <div class="card main-card ">
                    <div class="row pt-2">
                        <a asp-action="Index" asp-area="BS" asp-controller="ContractSettlement" style="width: fit-content;">
                            <img src="~/BranchSys/Pages/img/cancel.png" alt="cancle_icon" class="cancle-icon">
                        </a>
                    </div>

                    <div class="row flex-row-reverse">
                        <div class="col justify-content-center d-flex title-row">
                            <span class="card-title">
                                @localizer["ContractSettlement"]
                            </span>
                        </div>

                    </div>
                    <div class="row justify-content-center content-row h-100">

                        <div class="col-md-11 mx-0 h-100">

                            <form id="SettlementForm" asp-area="BS" asp-controller="ContractSettlement" asp-action="Create" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                                <div class=" ">
                                    <!-- progressbar -->
                                    <ul id="progressbar">
                                        <li class="active" id="Rental_terms">@localizer["TermsRented"]</li>
                                        <li id="Expenses">@localizer["Expenses"]</li>
                                        <li id="compensation">@localizer["Compensations"]</li>
                                        <li id="check">@localizer["VirtualInspection"]</li>
                                        <li id="payment">@localizer["Payment"]</li>
                                    </ul>
                                </div>
                                <fieldset id="firstFieldset">
                                    <div class="form-card SettlementCard1 ">
                                        <a href="#" target="_blank" class="pdf-anchor"><img src="~/BranchSys/Pages/img/pdf.png" alt="pdf for contract details" class="pdf_img"></a>
                                        <div class="row data-row-Settl ">
                                            <div class="col-xl-4 data-col-Settl contract-Settl-row ">
                                                <div class="col-auto ">
                                                    <P>@localizer["ContractNo"]</P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P>@Model.ContractSettlement.CrCasRenterContractBasicNo</P>
                                                </div>
                                                <div class="col-md-8 col-lg-10 seacrh-icon-col ">
                                                    <div>
                                                        <img src="~/BranchSys/Pages/img/seacrh-icon.png" alt="seacrh-icon Image" id="hover-image-Settlement">
                                                    </div>
                                                    <div class="dropdown-content" id="dropdown-content-Settlement">
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Renterr"] </p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasic5?.CrCasRenterLessorNavigation.CrMasRenterInformationEnName</p>
                                                                }
                                                                else
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasic5?.CrCasRenterLessorNavigation.CrMasRenterInformationArName</p>
                                                                }
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Car"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasicCarSerailNoNavigation?.CrCasCarInformationConcatenateEnName</p>
                                                                }
                                                                else
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasicCarSerailNoNavigation?.CrCasCarInformationConcatenateArName</p>
                                                                }
                                                            </div>

                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["StartContract"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedStartDate?.ToString("yyyy/MM/dd HH:mm:ss", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["ExpectedEndContract"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedEndDate?.ToString("yyyy/MM/dd HH:mm:ss", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> : @localizer["ExpectedDaysNo"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedRentalDays</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> : @localizer["EndAuth"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.AuthEndDate?.ToString("yyyy/MM/dd", CultureInfo.InvariantCulture)</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class=" col-md-auto col-lg-6 data-col-Settl flex-wrap Settlement-date ">
                                                <div class="col-auto ">
                                                    <P>@localizer["SettlementDate"]</P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P>@DateTime.Now.ToString("yyyy/MM/dd", CultureInfo.InvariantCulture)</P>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-row-Settl">
                                            <div class=" col-xl-8 data-col-Settl flex-wrap ">
                                                <div class="col-auto ">
                                                    <P>@localizer["ContractValue"]</P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P>@Model.ContractSettlement.CrCasRenterContractBasicExpectedTotal?.ToString("N2", CultureInfo.InvariantCulture)</P>
                                                </div>
                                                <div class="col-md-6 col-lg-5 col-xl-5 seacrh-icon-col">
                                                    <div>
                                                        <img src="~/BranchSys/Pages/img/seacrh-icon.png" alt="seacrh-icon Image" id="contract-value-Settlement2">
                                                    </div>
                                                    <div class="dropdown-content" id="dropdown-content-Settlement2">
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["RentalValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedRentValue?.ToString("N2", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["DelegationValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicAuthorizationValue?.ToString("N2", CultureInfo.InvariantCulture)</p>
                                                            </div>
                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Features"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.AdvantagesValue</p>
                                                            </div>
                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["AdditionalDriver"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicAdditionalDriverValue?.ToString("N2", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["PrivateDriver"] </p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedPrivateDriverValue?.ToString("N2", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Choices"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedOptionsValue?.ToString("N2", CultureInfo.InvariantCulture)</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Additionals"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p> @Model.ContractSettlement.CrCasRenterContractBasicAdditionalValue?.ToString("N2", CultureInfo.InvariantCulture) </p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["DiscountValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p> @Model.ContractSettlement.CrCasRenterContractBasicExpectedDiscountValue?.ToString("N2", CultureInfo.InvariantCulture) </p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["TaxValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p> @Model.ContractSettlement.CrCasRenterContractBasicExpectedTaxValue?.ToString("N2", CultureInfo.InvariantCulture) </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-row-Settl g-3">
                                            <div class="col-md-auto col-lg-4  data-col-Settl flex-wrap">
                                                <div class="col-auto">
                                                    <label for="contract_real_endTime">
                                                        @localizer["EndOfSettlement"]
                                                    </label>
                                                </div>
                                                <div class="col-md-6">
                                                    <input type="date" id="contract_real_endTime" class="form-control inputs" name="contract-end-date" aria-describedby="inputGroupPrepend" required>
                                                    <div class="row requird-field-row-last">
                                                        <div class="invalid-feedback" style="display: none;">
                                                            هذا الحقل مطلوب
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="col-md-auto col-lg-4  data-col-Settl flex-wrap">
                                                <div class="col-auto">
                                                    <p>@localizer["ActualNumberOfDays"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <P id="daysNo">0</P>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="row data-row-Settl">

                                            <div class="col-md-4 data-col-Settl ">
                                                <div class="col-auto">
                                                    <p>@localizer["AddHours"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    <span id="diffHours">00</span>:<span id="diffMinutes">00</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-lg-4  data-col-Settl flex-wrap" id="mechanismSettlement" style="display:none">
                                                <div class="col-auto">
                                                    <label for="Settlement-mechanism">
                                                        @localizer["SettlementMechanism"]
                                                    </label>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="offset">
                                                        <select class="form-select form-select-settel" id="Settlement-mechanism" asp-for="ContractSettlement.SettlementMechanism">
                                                            <option selected disabled>
                                                            </option>
                                                            <option value="0">@localizer["Without"]</option>
                                                            <option value="1">@localizer["Day"]</option>
                                                            <option value="2">@localizer["DayHalf"]</option>
                                                            <option value="3">@localizer["DayQuarter"]</option>
                                                        </select>

                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" id="requird_field_SettlementMechanism" asp-validation-for="@Model.ContractSettlement.SettlementMechanism"></span>
                                                        </div>
                                                    </div>

                                                </div>

                                            </div>
                                        </div>

                                        <div class="row data-row-Settl">
                                            <div class="col-md-auto col-lg-4  data-col-Settl flex-wrap">
                                                <div class="col-auto">
                                                    <p>@localizer["ReceivingBranch"] </p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                    {
                                                        <P>@Model.ContractSettlement?.CrCasRenterContractBasic1?.CrCasBranchInformationEnShortName</P>
                                                    }
                                                    else
                                                    {
                                                        <P>@Model.ContractSettlement?.CrCasRenterContractBasic1?.CrCasBranchInformationArShortName</P>
                                                    }
                                                </div>

                                            </div>
                                            <div class="col-md-4 data-col-Settl ">
                                                <div class="col-auto">
                                                    <p>@localizer["DeliveryBranch"]</p>
                                                </div>
                                                <div class="col-auto personal-data">
                                                    @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                    {
                                                        <P>@Model.CrCasBranchInformation?.CrCasBranchInformationEnShortName</P>
                                                    }
                                                    else
                                                    {
                                                        <P>@Model.CrCasBranchInformation?.CrCasBranchInformationArShortName</P>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-row-Settl ">
                                            <div class="col-md-auto col-lg-4  data-col-Settl flex-wrap">

                                                <div class="col-auto ">
                                                    <label class="form-check-label" for="expenses">@localizer["Expense"]</label>
                                                    <input class="form-check-input Settlement-input-checkbox" type="checkbox" value="checked" id="expenses-check" name="checked-expenses">

                                                </div>

                                            </div>
                                            <div class="col-md-4 data-col-Settl mb-4 ">

                                                <div class="col-auto ">
                                                    <label class="form-check-label" for="compensation-check">@localizer["Compensation"]</label>
                                                    <input class="form-check-input Settlement-input-checkbox" type="checkbox" value="checked" id="compensation-check" name="checked-compensation">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/Pages/img/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                        </div>
                                    </div>


                                </fieldset>
                                <fieldset id="SecondFieldset">
                                    <div class="form-card form-card1">
                                        <div class="row flex-row-reverse">
                                            <div class="row">
                                                <div class="expensesDiv align-items-baseline ">
                                                    <div class="col-auto">
                                                        <label id="expensesValue" for="expensesValue-input">@localizer["ExpenseValue"]</label>
                                                    </div>
                                                    <div class="col-auto">
                                                        <input type="tel" class="form-control form-control1" style="width: 130px;" id="expensesValue-input" asp-for="ContractSettlement.ExpensesValue" aria-describedby="inputGroupPrepend" autocomplete="off" required>
                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" id="requird_field_ExpensesValue" asp-validation-for="@Model.ContractSettlement.ExpensesValue"></span>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="row flex-row-reverse expensesRow g-5">
                                            <div class="col-lg-5">

                                                <div class="row expensesDiv expensesDiv-textarea ">
                                                    <div class="col-auto">
                                                        <label id="Expense-statement" for="Expense-statement-input">@localizer["ExpenseStatement"]</label>
                                                    </div>
                                                    <div class="col-lg-9" style="height: 100%;">
                                                        <textarea class="form-control textarea-inputs h-100" cols="25" asp-for="ContractSettlement.ExpensesReasons" id="Expense-statement-input" aria-describedby="inputGroupPrepend"></textarea>
                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" id="requird_field_ExpensesReasons" asp-validation-for="@Model.ContractSettlement.ExpensesReasons"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="upload__box d-flex">
                                                    <div class="upload_img-wrap_inner" style="display: flex;
                                                                  flex-wrap: wrap;
                                                                  gap: 10px ">
                                                        <div class="upload__img-box " id="FirstUpload-img">
                                                        </div>
                                                        <div class="upload__btn-box" id="upload__btn-box">
                                                            <label class="upload__btn">
                                                                <div class="upload-container-checking">
                                                                    <img class="upload-icon" src="~/BranchSys/Pages/img/Group (1).png" alt="Upload Icon" id="addImage">
                                                                    <input type="file" multiple accept="image/*" id="Expenses-images" class="upload__inputfile ">
                                                                </div>
                                                            </label>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="row">
                                                    <p style="color: red;" id="ExpensesError">  </p>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/Pages/img/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/Pages/img/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; ">
                                        </div>
                                    </div>


                                </fieldset>
                                <fieldset id="ThirdFieldset">
                                    <div class="form-card form-card1">
                                        <div class="row flex-row-reverse">
                                            <div class="row">
                                                <div class="expensesDiv align-items-baseline ">
                                                    <div class="col-auto">
                                                        <p> @localizer["CrMasUserContractValidityInsurance"] </p>
                                                    </div>
                                                    <div class="col-auto personal-data">
                                                        <p>@localizer["AgainstOthers"] </p>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="compensation-Div align-items-baseline ">
                                                <div class="col-auto">
                                                    <label for="compensation-input">@localizer["CompensationValue"]</label>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="tel" class="form-control form-control1" style="width: 130px;" id="compensation-input" asp-for="ContractSettlement.CompensationValue" aria-describedby="inputGroupPrepend" autocomplete="off" required>
                                                    <div class="row requird-field-row-last">
                                                        <span class="requird-field" id="requird_field_CompensationValue" asp-validation-for="@Model.ContractSettlement.CompensationValue"></span>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>

                                        <div class="row flex-row-reverse compensation-Row  g-5">
                                            <div class="col-lg-5">

                                                <div class="row compensation-Div compensation-Div-textarea ">
                                                    <div class="col-auto">
                                                        <label for="compensation-statement-input">@localizer["CompensationStatement"]</label>
                                                    </div>
                                                    <div class="col-lg-9" style="height: 100%;">
                                                        <textarea class="form-control textarea-inputs h-100" cols="25" asp-for="ContractSettlement.CompensationReasons" id="compensation-statement-input" aria-describedby="inputGroupPrepend" required></textarea>
                                                        <div class="row requird-field-row-last">
                                                            <span class="requird-field" id="requird_field_CompensationReasons" asp-validation-for="@Model.ContractSettlement.CompensationReasons"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="upload__box d-flex">
                                                    <div class="upload_img-wrap_inner" style="display: flex;flex-wrap: wrap; gap: 10px ">
                                                        <div class="upload__img-box " id="FirstUpload-img2">
                                                        </div>
                                                        <div class="upload__btn-box">
                                                            <label class="upload__btn">
                                                                <div class="upload-container-checking">
                                                                    <img class="upload-icon" src="~/BranchSys/Pages/img/Group (1).png" alt="Upload Icon" id="AddImageCompensation">
                                                                    <input type="file" multiple accept="image/*" id="compensation-images" class="upload__inputfile ">
                                                                </div>
                                                            </label>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="row">
                                                    <p style="color: red;" id='compensationError'> </p>
                                                </div>
                                            </div>

                                        </div>

                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/Pages/img/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/Pages/img/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; ">
                                        </div>
                                    </div>


                                </fieldset>
                                <fieldset id="FourthFieldset">
                                    <div class="form-card">
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <div class="row CurrentReadingg_row flex-row-reverse">
                                                    <div class="col-md-6 sett_checkField">
                                                        <div class="col-auto ">
                                                            <p> @localizer["ReadingBefore"]</p>
                                                        </div>
                                                        <div class="col personal-data">
                                                            <p id="PreviousKM">@Model.ContractSettlement.CrCasRenterContractBasicCurrentReadingMeter?.ToString("N0")</p>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 sett_checkField">
                                                        <div class="col-auto ">
                                                            <p> @localizer["DailyFreeKm"] </p>
                                                        </div>
                                                        <div class="col personal-data">
                                                            <p id="FreeKM">@Model.ContractSettlement.CrCasRenterContractBasicTotalDailyFreeKm?.ToString("N0")</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row CurrentReadingg_row flex-row-reverse">
                                                    <div class="col-md-6 sett_checkField flex-wrap">
                                                        <div class="col-auto">
                                                            <label id="CurrentReadingg"
                                                                   for="CurrentReadingg-input">
                                                                @localizer["CurrentMeter"]
                                                            </label>
                                                        </div>
                                                        <div class="col-lg-auto  d-flex flex-column align-items-end">
                                                            <input type="text" class="form-control form-control1" style="width: 130px;" id="CurrentMeter" asp-for="ContractSettlement.CurrentMeter" aria-describedby="inputGroupPrepend" oninput="this.value=this.value.replace(/[^0-9]/g,'')" autocomplete="off" maxlength="7">
                                                            <div class="row requird-field-row-last mb-2" style="height: 52px;">
                                                                <div class="col-12">
                                                                    <span class="requird-field" style="font-size: .625rem;" id="requird_field_CurrentMeter" asp-validation-for="@Model.ContractSettlement.CurrentMeter"></span>
                                                                    <div>
                                                                        <span class="requird-field" id="Error_CurrentMeter" style="font-size: .625rem; color: red;"></span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 sett_checkField">
                                                        <div class="col-auto ">
                                                            <p> @localizer["AdditionalKm"] </p>
                                                        </div>
                                                        <div class="col personal-data">
                                                            <p id="AdditionalKM">0</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="upload__box d-flex">
                                                    <div class="upload_img-wrap_inner" style="display: flex; flex-wrap: wrap; gap: 10px ">
                                                        <div class="upload__img-box " id="FirstUpload-img3">
                                                        </div>
                                                        <div class="upload__btn-box">
                                                            <label class="upload__btn">
                                                                <div class="upload-container-checking">
                                                                    <img class="upload-icon" src="~/BranchSys/Pages/img/Group (1).png" alt="Upload Icon" id="">
                                                                    <input type="file" multiple accept="image/*" id="examination-images" class="upload__inputfile ">
                                                                </div>
                                                            </label>
                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="row">
                                                    <p style="color: red;" id="examinationError"> </p>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <div class="table-scroll " id="SettlementTable">
                                                    <table class="table table-bordered  table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col"
                                                                    class="value-tabel-header">
                                                                    @localizer["reasons"]
                                                                </th>
                                                                <th scope="col"
                                                                    style='border-left: 1px solid #ff9626a3; width: 40%; '>
                                                                    @localizer["CheckUpNames"]
                                                                </th>

                                                            </tr>
                                                        </thead>
                                                        <tbody id="CheckBody">
                                                            <partial name="_CheckUpListSettlement" />
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row button-row">
                                        <div class="button-card">
                                            <img src="~/BranchSys/Pages/img/Group.png" alt="Button Image"
                                                 class="next action-button"
                                                 style="vertical-align: middle; ">
                                            <input type="button" name="next" class="next action-button"
                                                   value="@localizer["Next"]" />
                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous"
                                                   value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/Pages/img/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; ">
                                        </div>
                                    </div>

                                </fieldset>
                                <fieldset id="FifthFieldset">
                                    <div class="form-card form-card5-settl">
                                        <div class="row data-col-Settl g-3">
                                            <div class="col-xl-4 data-col-Settl contract-Settl-row ">
                                                <div class="col-auto ">
                                                    <P>@localizer["ContractNo"]  </P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P>@Model.ContractSettlement.CrCasRenterContractBasicNo</P>
                                                </div>
                                                <div class="col-md-8 col-lg-10 seacrh-icon-col1">
                                                    <div>
                                                        <img src="~/BranchSys/Pages/img/seacrh-icon.png" alt="seacrh-icon Image" id="contract-value-Settlement3">
                                                    </div>
                                                    <div class="dropdown-content" id="dropdown-content-Settlement3">
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>  : @localizer["Renterr"] </p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasic5?.CrCasRenterLessorNavigation.CrMasRenterInformationEnName</p>
                                                                }
                                                                else
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasic5?.CrCasRenterLessorNavigation.CrMasRenterInformationArName</p>
                                                                }
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["Car"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                @if (requestCulture?.RequestCulture.UICulture.Name != "ar-EG")
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasicCarSerailNoNavigation?.CrCasCarInformationConcatenateEnName</p>
                                                                }
                                                                else
                                                                {
                                                                    <p>@Model.ContractSettlement.CrCasRenterContractBasicCarSerailNoNavigation?.CrCasCarInformationConcatenateArName</p>
                                                                }
                                                            </div>
                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["StartContract"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicExpectedStartDate?.ToString("yyyy/MM/dd HH:mm:ss", CultureInfo.InvariantCulture)</p>
                                                            </div>
                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["EndContract"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="EndContract"></p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["DaysNo"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="DaysNoContract"></p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> : @localizer["EndAuth"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.AuthEndDate?.ToString("yyyy/MM/dd", CultureInfo.InvariantCulture)</p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["DiscountRate"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>%@Model.ContractSettlement.CrCasRenterContractBasicUserDiscountRate?.ToString("N2")</p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>: @localizer["TaxRate"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>%@Model.ContractSettlement.CrCasRenterContractBasicTaxRate?.ToString("N2") </p>
                                                            </div>
                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> : @localizer["ExtraHourValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicHourValue?.ToString("N2", CultureInfo.InvariantCulture) </p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> : @localizer["AdditionalKmValue"]  </p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p>@Model.ContractSettlement.CrCasRenterContractBasicKmValue?.ToString("N2", CultureInfo.InvariantCulture) </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class=" col-md-auto col-lg-6 data-col-Settl flex-wrap Settlement-date">
                                                <div class="col-auto ">
                                                    <P>@localizer["SettlementDate"]</P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P>@DateTime.Now.ToString("yyyy/MM/dd", CultureInfo.InvariantCulture)</P>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-col-Settl g-3">
                                            <div class=" col-xl-8 data-col-Settl flex-wrap ">
                                                <div class="col-auto ">
                                                    <P>@localizer["ContractValue"]</P>
                                                </div>
                                                <div class="col-auto personal-data ">
                                                    <P id="ContractValue">0.00</P>
                                                </div>
                                                <div class="col-md-6 col-lg-5 col-xl-5 seacrh-icon-col">
                                                    <div>

                                                        <img src="~/BranchSys/Pages/img/seacrh-icon.png" alt="seacrh-icon Image" id="contract-value-Settlement4">
                                                    </div>
                                                    <div class="dropdown-content" id="dropdown-content-Settlement4">
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["RentalValue"] </p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="RentalValue">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>:@localizer["DelegationValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="DelegationValue">0.00</p>
                                                            </div>

                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p>:@localizer["Features"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="Features">0.00</p>
                                                            </div>

                                                        </div>

                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["AdditionalDriver"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="AdditionalDriver">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["PrivateDriver"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="PrivateDriver">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["Choices"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="Choices">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["Additionals"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="Additionals">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["ExtraHoursValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="ExtraHoursValue">0.00</p>
                                                            </div>

                                                        </div>
                                                        <div class="row dropdown-content-row">
                                                            <div class="col-auto ">
                                                                <p> :@localizer["ExtraKMsValue"]</p>
                                                            </div>
                                                            <div class="col personal-data">
                                                                <p id="ExtraKMsValue">0.00</p>
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-col-Settl g-3">

                                            <div class="col-md-4">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["ContractValueAfterDiscount"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="ContractValueAfterDiscount">0.00</p></div>
                                                </div>
                                            </div>
                                            <div class="col-md-auto">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["TaxValue"] </p></div>
                                                    <div class="col-auto personal-data p-0"><p id="TaxValue">0.00</p></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-col-Settl g-3">
                                            <div class="col-md-4">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["TotalContract"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="TotalContract">0.00</p></div>
                                                </div>

                                            </div>
                                            <div class="col-md-4">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["TotalExpenseValue"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="TotalExpenseValue">0.00</p></div>
                                                </div>
                                            </div>
                                            <div class="col-md-auto">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["TotalCompensationValue"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="TotalCompensationValue">0.00</p></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-col-Settl g-3">
                                            <div class="col-md-4">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["PreviousBalance"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p>@Model.ContractSettlement.CrCasRenterContractBasic5.CrCasRenterLessorAvailableBalance?.ToString("N2")</p></div>
                                                </div>

                                            </div>
                                            <div class="col-md-4">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p>@localizer["AmountRequired"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="AmountRequired">۱۷۲۹.۷۹</p></div>
                                                </div>
                                            </div>
                                            <div class="col-md-auto">
                                                <div class="data-col-Settl">
                                                    <div class="col-auto "><p id="RenterMoneyText">@localizer["RenterMoneyText1"]</p></div>
                                                    <div class="col-auto personal-data p-0"><p id="RenterMoneyValue">0.00</p></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row data-col-Settl g-3">
                                            <div class="col-md-auto col-lg-4 data-col-Settl">
                                                <div class="col-auto">
                                                    <label id="amount-paid" for="amount-paid-input">
                                                        @localizer["AmountPaid"]
                                                    </label>
                                                </div>
                                                <div class="col-auto">
                                                    <input type="text" class="form-control form-control2" asp-for="ContractSettlement.AmountPayed" id="AmountPayed" oninput="handleAmountPayed(this)" name="amount-paid" autocomplete="off" required>
                                                    <div class="row requird-field-row-last">
                                                        <p class="requird_field_AmountPayed"></p>
                                                    </div>
                                                </div>

                                            </div>

                                            <div class="col-md-auto col-lg-4 d-flex flex-nowrap data-col-Settl">
                                                <div class="col-auto d-flex ps-0">
                                                    <label id="payment-method" for="payment-method-select">@localizer["PaymentMethod"]</label>

                                                </div>

                                                <div class="col-auto ">
                                                    <div class="offset">
                                                        <select class="form-select form-select-last" id="payment-method-select" name="payment-method" required>
                                                            <option selected disabled>
                                                            </option>
                                                            <option value="نقدا"> نقدا</option>
                                                            <option value="مدي"> مدي</option>
                                                            <option value="فيزا"> فيزا</option>
                                                            <option value="فيزا"> ماسترد كارد</option>
                                                        </select>
                                                        <div class="row requird-field-row-last">
                                                            <div class="invalid-feedback" style="display: none;">
                                                                هذا الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div class="col-md-auto  data-col-Settl ">
                                                <div class="col-auto d-flex ps-0 ">
                                                    <label id="selling-point" for="selling-point-dropdown">@localizer["SalesPoint"]</label>
                                                </div>
                                                <div class="col-auto ">
                                                    <div class="offset">
                                                        <select class="form-select form-select-last"
                                                                id="selling-point-dropdown" name="selling-point" required>
                                                            <option selected disabled>           </option>
                                                            <option value=""> hghghghhfhfgfghdfdfgdgdcg           </option>
                                                            <option value="">            </option>
                                                            <option value="">             </option>
                                                        </select>
                                                        <div class="row requird-field-row-last">
                                                            <div class="invalid-feedback" style="display: none;">
                                                                هذا الحقل مطلوب
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                            </div>
                                        </div>
                                        <div class="row p-2" style="flex-direction:row-reverse">
                                            <div class="col-auto">
                                                <label id="notes" for="FormControl-last-Textarea">@localizer["Reasons"]</label>
                                            </div>
                                            <div class="col-sm-10 col-md-7 col-lg-7">
                                                <textarea class="form-control textarea-inputs"
                                                          rows="1"
                                                          maxlength="100" name="notes"></textarea>
                                            </div>

                                        </div>
                                    </div>

                                    <div class="row button-row align-items-center"
                                         style="padding: 6px 7px 0px 20px;">
                                        <div class="button-card  gap-2">
                                            <button id="submitForm" class="btn btn-custom next">@localizer["Save"]</button>

                                        </div>
                                        <div class="button-card">
                                            <input type="button" name="previous"
                                                   class="previous action-button-previous" value="@localizer["Previous"]" />
                                            <img src="~/BranchSys/Pages/img/Vector.png" alt="Button Image"
                                                 class="previous action-button-previous"
                                                 style="vertical-align: middle; margin-right: 10px;">
                                        </div>
                                    </div>

                                </fieldset>
                            </form>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </section>
</div>


<footer class="fixed-bottom-xl">
    <div class="before-footer-widget">
        <svg width: 100%; height:auto viewbox="0 0 2444 132">
            <path fill="rgba(254, 248, 232, 1)" fill-rule="evenodd"
                  d="M1222 0h1222c-444.13 88-852.127 132-1223.993 132C849.253 132 442.585 88.263 0 .789V0h1222z">
            </path>
        </svg>
    </div>

</footer>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/BranchSys/Pages/js/Settlement.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const now = new Date();
            const year = now.getFullYear().toString().padStart(4, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const dateValue = `${year}-${month}-${day}`;

            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const timeValue = `${hours}:${minutes}`;

            document.getElementById("contract_real_endTime").value = dateValue;
            document.getElementById("settlementTime").value = timeValue;

        });
        //To Hide mechanismSettlement..
        // document.addEventListener("DOMContentLoaded", function () {
        //     const endDateString = "@Model.ContractSettlement.CrCasRenterContractBasicExpectedEndDate?.ToString("yyyy/MM/dd HH:mm:ss", CultureInfo.InvariantCulture)";
        //     const endDate = new Date(endDateString);
        //     const currentDate = new Date();
        //     const elementToHide = document.getElementById("mechanismSettlement");
        //     console.log("endDate", endDate)
        //     console.log("currentDate", currentDate)
        //     if (currentDate > endDate) {
        //         if (elementToHide) {
        //             elementToHide.style.display = "";
        //         }
        //     }

        // });

        document.addEventListener("DOMContentLoaded", function () {
            const elementToHide = document.getElementById("mechanismSettlement");
            var SettelmentAuth = "@userInfo?.CrMasUserContractValidity?.CrMasUserContractValidityEnd";
            const startContractDateString = "@Model.ContractSettlement.CrCasRenterContractBasicExpectedStartDate?.ToString("yyyy-MM-ddTHH:mm:ss", CultureInfo.InvariantCulture)";
            const TotalFreeHours = "@Model.ContractSettlement.CrCasRenterContractBasicTotalFreeHours";
            const MaxHours = "@Model.ContractSettlement.CrCasRenterContractBasicHourMax";
            console.log("TotalFreeHours", TotalFreeHours);
            console.log("MaxHours", MaxHours);
            console.log("SettelmentAuth", SettelmentAuth);

            const startContractDate = new Date(startContractDateString);
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const currentSecond = now.getSeconds();
            // Convert hour, minute, and second to strings if needed
            const hourString = currentHour.toString().padStart(2, '0'); // Pad with zero if single digit
            const minuteString = currentMinute.toString().padStart(2, '0'); // Pad with zero if single digit
            const secondString = currentSecond.toString().padStart(2, '0'); // Pad with zero if single digit
            const timeString = `${hourString}:${minuteString}:${secondString}`;

            function calculateDifference() {
                const settlementDateString = document.getElementById("contract_real_endTime").value;

                const settlementDateTimeString = settlementDateString + "T" + timeString;
                const settlementDateTime = new Date(settlementDateTimeString);

                const timeDiff = Math.abs(settlementDateTime.getTime() - startContractDate.getTime());
                const diffDays = Math.floor(timeDiff / (1000 * 3600 * 24)); // Difference in days
                const diffHours = Math.floor((timeDiff % (1000 * 3600 * 24)) / (1000 * 3600)); // Remaining difference in hours
                const diffMinutes = Math.floor((timeDiff % (1000 * 3600)) / (1000 * 60)); // Remaining difference in minutes
                var diff = parseInt(diffHours) - parseInt(TotalFreeHours) - parseInt(MaxHours);
                console.log("diff", diff);
                $("#daysNo").text(diffDays);

                //In PaymentPage
                var endContractDate = new Date(startContractDate);
                endContractDate.setDate(startContractDate.getDate() + diffDays);
                // Formatting endContractDate as "yyyy/MM/dd HH:MM"
                var formattedEndContractDate = endContractDate.getFullYear() + '/' +('0' + (endContractDate.getMonth() + 1)).slice(-2) + '/' +('0' + endContractDate.getDate()).slice(-2) + ' ' +
                                              ('0' + endContractDate.getHours()).slice(-2) + ':' +('0' + endContractDate.getMinutes()).slice(-2) + ':00';
                $("#DaysNoContract").text(diffDays);
                $("#EndContract").text(formattedEndContractDate);
                ////////////////////////////////////////////////////////////
                if (diff >= 0 && diffMinutes >= 0) {
                    $("#diffHours").text(diff.toString().padStart(2, '0'));
                    $("#diffMinutes").text(diffMinutes.toString().padStart(2, '0'));
                    if (elementToHide) {
                        elementToHide.style.display = "";
                    }
                }
                else {
                    $("#diffHours").text("00");
                    $("#diffMinutes").text("00");
                }
                if (SettelmentAuth.toLowerCase() === "false" || SettelmentAuth == null || SettelmentAuth == "") {
                    $("#contract_real_endTime").prop('readonly', true).css('background-color', 'white');
                }
                console.log("Difference in days:", diffDays);
                console.log("Remaining difference in hours:", diffHours);
                console.log("Remaining difference in minutes:", diffMinutes);
            }

            document.getElementById("contract_real_endTime").addEventListener("change", calculateDifference);

            // Call calculateDifference function when the page loads
            calculateDifference();
        });
    </script>
    <script>
        function clearExpensesData() {
            $("#expensesValue-input").val('');
            $("#Expense-statement-input").val('');
            $("#requird_field_ExpensesValue").text('').css("color", "");
            $("#requird_field_ExpensesReasons").text('').css("color", "");
            $("#ExpensesError").text('');
            ExpensesArray.splice(0, ExpensesArray.length);
            $('#SecondFieldset .upload__img-box').remove();
            console.log("ExpensesArray", ExpensesArray);
        }

        function clearCompensationData() {
            $("#compensation-input").val('');
            $("#compensation-statement-input").val('');
            $("#requird_field_CompensationValue").text('').css("color", "");
            $("#requird_field_CompensationReasons").text('').css("color", "");
            $("#compensationError").text('');
            compensationArray.splice(0, compensationArray.length);
            $('#ThirdFieldset .upload__img-box').remove();
            console.log("compensationArray", compensationArray);
        }








        // Function to calculate and update additional KM
        function calculateAdditionalKM(enteredValue) {
            var PreviousMeterInput = '@Model.ContractSettlement.CrCasRenterContractBasicCurrentReadingMeter';
            var PreviousMeterValue = parseInt(PreviousMeterInput) || 0;
            var AdditionalKmFreeDaily = '@Model.ContractSettlement.CrCasRenterContractBasicTotalDailyFreeKm';
            var DaysNo = parseInt($("#daysNo").text());
            var settlementMechanismValue = parseInt($("#Settlement-mechanism").val());
            var totalDaysNo;
            if (settlementMechanismValue == 0) {
                totalDaysNo = DaysNo;
            }
            else if (settlementMechanismValue == 1) {
                totalDaysNo = DaysNo + 1;
            }
            else if (settlementMechanismValue == 2) {
                totalDaysNo = DaysNo + (1 / 2);
            }
            else {
                totalDaysNo = DaysNo + (1 / 4);
            }
            var TotalAdditionalKM = parseFloat(totalDaysNo) * parseInt(AdditionalKmFreeDaily);
            console.log("PreviousMeterValue", PreviousMeterValue)
            console.log("AdditionalKmFreeDaily", AdditionalKmFreeDaily)
            console.log("DaysNo", DaysNo)
            console.log("totalDaysNo", totalDaysNo)
            console.log("TotalAdditionalKM", TotalAdditionalKM)
            if (enteredValue <= PreviousMeterValue) {
                $("#Error_CurrentMeter").text("@localizer["requirdfieldCurrentMeter"]" + " " + PreviousMeterValue);
            } else {
                var Free = TotalAdditionalKM + PreviousMeterValue;
                var Additional = enteredValue - Free;
                console.log("Free", Free)
                console.log("Additional", Additional)

                if (Additional <= 0) {
                    $("#AdditionalKM").text("0");
                } else {
                    $("#AdditionalKM").text(Additional.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 }));
                }
                $("#Error_CurrentMeter").text("");
            }
        }
        var CurrentMeterInput = $("#CurrentMeter");
        // Bind events to CurrentMeterInput
        CurrentMeterInput.on("focusout", function () {
            var enteredValue = parseFloat($(this).val()) || 0;
            calculateAdditionalKM(enteredValue);
        });
    </script>
    <script>
        // $("#Settlement-mechanism").change(function () {
        //     console.log($("#SettlementForm"));
        // })

        const nextButtons = document.querySelectorAll(".next");

        Array.from(nextButtons).forEach((nextBtn) => {
            nextBtn.addEventListener("click", (event) => {
                var field = nextBtn.closest("fieldset");
                const ExpensesCheckbox = document.getElementById('expenses-check');
                const CompensationCheckbox = document.getElementById('compensation-check');
                const firsetfield = document.getElementById('firstFieldset');
                const fieldsets = document.querySelectorAll("fieldset");
                console.log("firsetfield", firsetfield);
                console.log("SettlementForm", $("#SettlementForm").valid());

                if ($("#SettlementForm").valid()) {
                    const current_fs = nextBtn.closest("fieldset");
                    let next_fs = current_fs.nextElementSibling;
                    console.log("current_fs.id", current_fs.id);
                    if (current_fs.id === 'firstFieldset') {

                        $("#ExpensesError").text('');
                        $("#requird_field_ExpensesValue").text('').css("color", "");
                        $("#requird_field_ExpensesReasons").text('').css("color", "");
                        if (!ExpensesCheckbox.checked && CompensationCheckbox.checked) {
                            clearExpensesData();
                            $("#requird_field_CompensationValue").text('').css("color", "");
                            $("#requird_field_CompensationReasons").text('').css("color", "");
                            $("#compensationError").text('');
                            next_fs = current_fs.nextElementSibling.nextElementSibling;
                            $("#progressbar li").eq($("fieldset").index(current_fs.nextElementSibling)).addClass("active");
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.style.display = "flex";
                            current_fs.style.display = "none";

                        } else if (!ExpensesCheckbox.checked && !CompensationCheckbox.checked) {
                            clearExpensesData();
                            clearCompensationData();
                            next_fs = current_fs.nextElementSibling.nextElementSibling.nextElementSibling;
                            $("#progressbar li").eq($("fieldset").index(current_fs.nextElementSibling)).addClass("active");
                            $("#progressbar li").eq($("fieldset").index(current_fs.nextElementSibling.nextElementSibling)).addClass("active");
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.style.display = "flex";
                            current_fs.style.display = "none";
                        }
                        else {
                            next_fs = current_fs.nextElementSibling;
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.style.display = "flex";
                            current_fs.style.display = "none";
                        }
                    }

                    if (current_fs.id === 'SecondFieldset') {
                        $("#ExpensesError").text('');
                        var imgs = true;
                        // Check if the div contains at least one img element
                        if ($('.upload__img-box img').length > 0) {
                            console.log("The div contains at least one img element");
                        } else {
                            imgs = false;
                            console.log("The div does not contain any img elements");
                        }
                        if (imgs) {
                            if (ExpensesCheckbox.checked && !CompensationCheckbox.checked) {
                                clearCompensationData();
                                next_fs = current_fs.nextElementSibling.nextElementSibling;
                                $("#progressbar li").eq($("fieldset").index(current_fs.nextElementSibling)).addClass("active");
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.style.display = "flex";
                                current_fs.style.display = "none";
                            }
                            else {
                                $("#requird_field_CompensationValue").text('').css("color", "");
                                $("#requird_field_CompensationReasons").text('').css("color", "");
                                $("#compensationError").text('');
                                $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                                next_fs.style.display = "flex";
                                current_fs.style.display = "none";
                            }
                        }
                        else {
                            $("#ExpensesError").text('@localizer["ExpensesMessageImageRequired"]');
                        }

                    }
                    if (current_fs.id === 'ThirdFieldset') {
                        $("#compensationError").text('');
                        var imgs = true;
                        // Check if the div contains at least one img element
                        if ($('.upload__img-box img.close2').length > 0) {
                            console.log("The div contains at least one img element");
                        } else {
                            imgs = false;
                            console.log("The div does not contain any img elements");
                        }
                        if (imgs) {
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.style.display = "flex";
                            current_fs.style.display = "none";
                        }
                        else {
                            $("#compensationError").text('@localizer["ExpensesMessageImageRequired"]');
                        }

                    }
                    if (current_fs.id === 'FourthFieldset') {
                        var allChecked = true;
                        var currentMeter = true;
                        var imgs = true;

                        // Check checkboxes
                        var checkboxes = document.querySelectorAll(".CheckUp");
                        checkboxes.forEach(function (checkbox) {
                            if (!checkbox.checked) {
                                allChecked = false;
                            }
                        });

                        // Check currentMeterSpan
                        var currentMeterSpan = $("#Error_CurrentMeter");
                        if (currentMeterSpan.text().trim() === "") {
                            console.log("Span is empty");
                        } else {
                            currentMeter = false;
                            console.log("Span is not empty");
                        }

                        // Check if the div contains at least one img element
                        if ($('.upload__img-box img.close3').length > 0) {
                            console.log("The div contains at least one img element");
                        } else {
                            imgs = false;
                            console.log("The div does not contain any img elements");
                        }
                        if (imgs && currentMeter && allChecked) {
                            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");
                            next_fs.style.display = "flex";
                            current_fs.style.display = "none";
                            CaculateContractSettelement();
                        }
                        else {
                            $("#examinationError").text('@localizer["checkUpMessageRequired"]')
                        }
                    }

                }
            });
        });

        const previousButtons = document.querySelectorAll(".previous");

        Array.from(previousButtons).forEach((prevBtn) => {
            prevBtn.addEventListener("click", (event) => {
                const ExpensesCheckbox = document.getElementById('expenses-check');
                const CompensationCheckbox = document.getElementById('compensation-check');
                const current_fs = prevBtn.closest("fieldset");
                let previous_fs = current_fs.previousElementSibling;
                if (current_fs.id === 'FourthFieldset') {

                    if (ExpensesCheckbox.checked && CompensationCheckbox.checked) {
                        previous_fs = current_fs.previousElementSibling;
                    } else if (!ExpensesCheckbox.checked && !CompensationCheckbox.checked) {
                        previous_fs = current_fs.previousElementSibling.previousElementSibling.previousElementSibling;
                        $("#progressbar li").eq($("fieldset").index(current_fs.previousElementSibling)).removeClass("active");
                        $("#progressbar li").eq($("fieldset").index(current_fs.previousElementSibling.previousElementSibling)).removeClass("active");
                    } else if (ExpensesCheckbox.checked && !CompensationCheckbox.checked) {
                        previous_fs = current_fs.previousElementSibling.previousElementSibling;
                        $("#progressbar li").eq($("fieldset").index(current_fs.previousElementSibling)).removeClass("active");
                    }
                }

                if (current_fs.id === 'ThirdFieldset') {

                    if (!ExpensesCheckbox.checked && CompensationCheckbox.checked) {
                        previous_fs = current_fs.previousElementSibling.previousElementSibling;
                        $("#progressbar li").eq($("fieldset").index(current_fs.previousElementSibling)).removeClass("active");

                    }
                }
                Array.from(previous_fs.elements).forEach((field) => {
                    //field.addEventListener('input', () => {
                    //    hideErrorMessage(field);
                    //});
                });
                $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

                previous_fs.style.display = "flex";
                current_fs.style.display = "none";
            });
        });
    </script>
    <script>
        function CaculateContractSettelement() {
            var daysNo = parseInt($("#daysNo").text());
            var settlementMechanismValue = parseInt($("#Settlement-mechanism").val());
            var totalDaysNo;
            if (settlementMechanismValue == 0) {
                totalDaysNo = daysNo;
            }
            else if (settlementMechanismValue == 1) {
                totalDaysNo = daysNo + 1;
            }
            else if (settlementMechanismValue == 2) {
                totalDaysNo = daysNo + (1 / 2);
            }
            else {
                totalDaysNo = daysNo + (1 / 4);
            }
            console.log("daysNo", daysNo)
            console.log("settlementMechanismValue", settlementMechanismValue)
            console.log("totalDaysNo", totalDaysNo)

        }
    </script>
    <script>
        function handleAmountPayed(input) {
            // Remove non-digit characters and additional decimal points
            input.value = input.value.replace(/[^0-9\.]/g, '');
            const decimalIndex = input.value.indexOf('.');
            // Limit to 9 digits before and after the decimal point
            if (decimalIndex !== -1) {
                const digitsBeforeDecimal = input.value.substring(0, decimalIndex);
                const digitsAfterDecimal = input.value.substring(decimalIndex + 1);

                // Limit to 2 digits after the decimal point
                input.value = digitsBeforeDecimal.substr(0, 7) + '.' + digitsAfterDecimal.substr(0, 2);

                // Remove additional decimal points
                if (input.value.indexOf('.', decimalIndex + 1) !== -1) {
                    const lastValidIndex = input.value.lastIndexOf('.');
                    input.value = input.value.substring(0, lastValidIndex) + input.value.substring(lastValidIndex + 1);
                }
            } else {
                // Limit to 7 digits before the decimal point
                input.value = input.value.substr(0, 7);
            }
        }
    </script>

}